<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama de Sankey MLESS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1500px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .analysis-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .keyword-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .keyword-box {
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
        }
        .ls-box { border-color: #4CAF50; background-color: rgba(76, 175, 80, 0.1); }
        .ts-box { border-color: #2196F3; background-color: rgba(33, 150, 243, 0.1); }
        .me-box { border-color: #FFC107; background-color: rgba(255, 193, 7, 0.1); }
        .shared-box { border-color: #9E9E9E; background-color: rgba(158, 158, 158, 0.1); }
        
        .keyword-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        .keyword-list li {
            padding: 4px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .keyword-list li:last-child {
            border-bottom: none;
        }
        h3 {
            margin-top: 0;
            font-weight: bold;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .instructions {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagrama de Sankey MLESS</h1>
            <p>An√°lisis de conexiones entre Liderazgo Sustentable, Teor√≠a de Sistemas y Modelo Ecol√≥gico de Bronfenbrenner</p>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(76, 175, 80, 0.8);"></div>
                <span><strong>Liderazgo Sustentable</strong></span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(33, 150, 243, 0.8);"></div>
                <span><strong>Teor√≠a de Sistemas</strong></span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(255, 193, 7, 0.8);"></div>
                <span><strong>Modelo Ecol√≥gico</strong></span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(158, 158, 158, 0.8);"></div>
                <span><strong>Palabras Clave Compartidas</strong></span>
            </div>
        </div>

        <div id="sankeyPlot" style="width: 100%; height: 800px;"></div>

        <div class="instructions">
            <h3>Instrucciones de uso:</h3>
            <ul>
                <li>Pase el cursor sobre los nodos para ver si es una Dimensi√≥n o Palabra Clave</li>
                <li>Pase el cursor sobre los enlaces para ver las conexiones espec√≠ficas</li>
                <li>Los nodos grises representan palabras clave compartidas entre dimensiones</li>
                <li>Las l√≠neas grises muestran conexiones cruzadas entre dimensiones</li>
            </ul>
        </div>

        <div class="analysis-section">
            <h2>An√°lisis de Palabras Clave</h2>
            
            <div class="keyword-section">
                <div class="keyword-box ls-box">
                    <h3>üü¢ Liderazgo Sustentable</h3>
                    <ul class="keyword-list" id="ls-keywords"></ul>
                </div>
                
                <div class="keyword-box ts-box">
                    <h3>üîµ Teor√≠a de Sistemas</h3>
                    <ul class="keyword-list" id="ts-keywords"></ul>
                </div>
                
                <div class="keyword-box me-box">
                    <h3>üü° Modelo Ecol√≥gico de Bronfenbrenner</h3>
                    <ul class="keyword-list" id="me-keywords"></ul>
                </div>
            </div>

            <div class="shared-box" style="margin-top: 20px; padding: 20px;">
                <h3>‚ö™ An√°lisis de Conexiones</h3>
                <div id="shared-analysis"></div>
            </div>
        </div>
    </div>

    <script>
        // Definici√≥n de palabras clave
        const liderazgoSustentableKeywords = [
            'Liderazgo', 'Educaci√≥n', 'Investigaci√≥n', 'Docente', 'Gesti√≥n',
            'Cambio', 'Transformaci√≥n', 'Mejora', 'Innovaci√≥n', 'Calidad',
            'Inclusi√≥n', 'Autonom√≠a', 'Desarrollo profesional', 'Comunidad educativa',
            'Instituciones educativas'
        ];

        const teoriaSistemasKeywords = [
            'Liderazgo', 'Educaci√≥n', 'Gesti√≥n', 'Instituciones educativas',
            'Docentes', 'Calidad educativa', 'Transformaci√≥n', 'Autonom√≠a',
            'Metacomplejidad', 'Innovaci√≥n', 'Sistema educativo', 'Administraci√≥n',
            'Directivo'
        ];

        const modeloEcologicoKeywords = [
            'Microsistema', 'Mesosistema', 'Exosistema', 'Macrosistema',
            'Cronosistema', 'Liderazgo', 'Educaci√≥n', 'Colaboraci√≥n',
            'Desarrollo profesional', 'Contexto', 'Interacciones',
            'Comunidad de pr√°ctica', 'Facilitadores de aprendizaje profesional',
            'STEM', 'Asociaciones escuela-familia-comunidad'
        ];

        function createSankeyDiagram() {
            const dimensions = ['Liderazgo Sustentable', 'Teor√≠a de Sistemas', 'Modelo Ecol√≥gico de Bronfenbrenner'];
            
            // Obtener todas las palabras clave √∫nicas
            const allKeywords = new Set([
                ...liderazgoSustentableKeywords,
                ...teoriaSistemasKeywords,
                ...modeloEcologicoKeywords
            ]);
            
            const nodes = dimensions.concat(Array.from(allKeywords).sort());
            const nodeDict = {};
            nodes.forEach((node, i) => nodeDict[node] = i);
            
            const source = [];
            const target = [];
            const value = [];
            const labels = [];
            const colors = [];
            
            const dimensionColors = {
                'Liderazgo Sustentable': 'rgba(76, 175, 80, 0.8)',
                'Teor√≠a de Sistemas': 'rgba(33, 150, 243, 0.8)',
                'Modelo Ecol√≥gico de Bronfenbrenner': 'rgba(255, 193, 7, 0.8)'
            };
            
            const datasets = {
                'Liderazgo Sustentable': liderazgoSustentableKeywords,
                'Teor√≠a de Sistemas': teoriaSistemasKeywords,
                'Modelo Ecol√≥gico de Bronfenbrenner': modeloEcologicoKeywords
            };
            
            // Enlaces desde cada dimensi√≥n a sus palabras clave
            for (const [dimension, keywords] of Object.entries(datasets)) {
                keywords.forEach(keyword => {
                    source.push(nodeDict[dimension]);
                    target.push(nodeDict[keyword]);
                    value.push(1);
                    labels.push(`${dimension} ‚Üí ${keyword}`);
                    colors.push(dimensionColors[dimension]);
                });
            }
            
            // Identificar palabras clave compartidas
            const sharedKeywords = {};
            allKeywords.forEach(keyword => {
                const dimensionsWithKeyword = [];
                if (liderazgoSustentableKeywords.includes(keyword)) {
                    dimensionsWithKeyword.push('Liderazgo Sustentable');
                }
                if (teoriaSistemasKeywords.includes(keyword)) {
                    dimensionsWithKeyword.push('Teor√≠a de Sistemas');
                }
                if (modeloEcologicoKeywords.includes(keyword)) {
                    dimensionsWithKeyword.push('Modelo Ecol√≥gico de Bronfenbrenner');
                }
                
                if (dimensionsWithKeyword.length > 1) {
                    sharedKeywords[keyword] = dimensionsWithKeyword;
                }
            });
            
            // Agregar conexiones cruzadas
            Object.entries(sharedKeywords).forEach(([keyword, dims]) => {
                if (dims.length >= 2) {
                    for (let i = 0; i < dims.length; i++) {
                        for (let j = i + 1; j < dims.length; j++) {
                            source.push(nodeDict[keyword]);
                            target.push(nodeDict[dims[j]]);
                            value.push(0.5);
                            labels.push(`${keyword} ‚Üí ${dims[j]} (Conexi√≥n cruzada)`);
                            colors.push('rgba(158, 158, 158, 0.6)');
                        }
                    }
                }
            });
            
            // Preparar colores de nodos
            const nodeColors = nodes.map(node => {
                if (dimensionColors[node]) {
                    return dimensionColors[node];
                } else if (sharedKeywords[node]) {
                    return 'rgba(158, 158, 158, 0.8)';
                } else if (liderazgoSustentableKeywords.includes(node)) {
                    return 'rgba(76, 175, 80, 0.6)';
                } else if (teoriaSistemasKeywords.includes(node)) {
                    return 'rgba(33, 150, 243, 0.6)';
                } else if (modeloEcologicoKeywords.includes(node)) {
                    return 'rgba(255, 193, 7, 0.6)';
                } else {
                    return 'rgba(200, 200, 200, 0.6)';
                }
            });
            
            const customData = nodes.map(node => 
                dimensions.includes(node) ? 'Dimensi√≥n' : 'Palabra Clave'
            );
            
            const data = [{
                type: "sankey",
                node: {
                    pad: 15,
                    thickness: 20,
                    line: { color: "black", width: 0.5 },
                    label: nodes,
                    color: nodeColors,
                    hovertemplate: '<b>%{label}</b><br>Tipo: %{customdata}<extra></extra>',
                    customdata: customData
                },
                link: {
                    source: source,
                    target: target,
                    value: value,
                    color: colors,
                    hovertemplate: '%{customdata}<extra></extra>',
                    customdata: labels
                }
            }];
            
            const layout = {
                title: {
                    text: "Diagrama de Sankey MLESS",
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 18 }
                },
                font: { size: 11, family: "Arial" },
                margin: { l: 50, r: 50, t: 100, b: 50 },
                paper_bgcolor: 'white',
                plot_bgcolor: 'white'
            };
            
            Plotly.newPlot('sankeyPlot', data, layout, {responsive: true});
        }
        
        function populateKeywordLists() {
            // Llenar listas de palabras clave
            const lsList = document.getElementById('ls-keywords');
            liderazgoSustentableKeywords.forEach((kw, i) => {
                const li = document.createElement('li');
                li.textContent = `${i + 1}. ${kw}`;
                lsList.appendChild(li);
            });
            
            const tsList = document.getElementById('ts-keywords');
            teoriaSistemasKeywords.forEach((kw, i) => {
                const li = document.createElement('li');
                li.textContent = `${i + 1}. ${kw}`;
                tsList.appendChild(li);
            });
            
            const meList = document.getElementById('me-keywords');
            modeloEcologicoKeywords.forEach((kw, i) => {
                const li = document.createElement('li');
                li.textContent = `${i + 1}. ${kw}`;
                meList.appendChild(li);
            });
        }
        
        function analyzeSharedKeywords() {
            const setLS = new Set(liderazgoSustentableKeywords);
            const setTS = new Set(teoriaSistemasKeywords);
            const setME = new Set(modeloEcologicoKeywords);
            
            const sharedAll = new Set([...setLS].filter(x => setTS.has(x) && setME.has(x)));
            const sharedLSTS = new Set([...setLS].filter(x => setTS.has(x) && !setME.has(x)));
            const sharedLSME = new Set([...setLS].filter(x => setME.has(x) && !setTS.has(x)));
            const sharedTSME = new Set([...setTS].filter(x => setME.has(x) && !setLS.has(x)));
            
            const analysisDiv = document.getElementById('shared-analysis');
            
            let html = `
                <h4>Compartidas entre las 3 dimensiones (${sharedAll.size}):</h4>
                <ul>${Array.from(sharedAll).sort().map(kw => `<li>${kw}</li>`).join('')}</ul>
                
                <h4>Solo entre Liderazgo Sustentable y Teor√≠a de Sistemas (${sharedLSTS.size}):</h4>
                <ul>${Array.from(sharedLSTS).sort().map(kw => `<li>${kw}</li>`).join('')}</ul>
                
                <h4>Solo entre Liderazgo Sustentable y Modelo Ecol√≥gico (${sharedLSME.size}):</h4>
                <ul>${Array.from(sharedLSME).sort().map(kw => `<li>${kw}</li>`).join('')}</ul>
                
                <h4>Solo entre Teor√≠a de Sistemas y Modelo Ecol√≥gico (${sharedTSME.size}):</h4>
                <ul>${Array.from(sharedTSME).sort().map(kw => `<li>${kw}</li>`).join('')}</ul>
            `;
            
            analysisDiv.innerHTML = html;
        }
        
        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            createSankeyDiagram();
            populateKeywordLists();
            analyzeSharedKeywords();
        });
    </script>
</body>
</html>